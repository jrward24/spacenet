<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Elements</title>
  <meta name="author" content="SpaceNet Team">
  <meta name="description" content="An editor for SpaceNet database objects.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.3.1/jszip-2.5.0/dt-1.10.25/af-2.3.7/b-1.7.1/b-colvis-1.7.1/b-html5-1.7.1/b-print-1.7.1/cr-1.5.4/date-1.1.0/fc-3.3.3/fh-3.1.9/kt-2.6.2/r-2.2.8/rg-1.1.3/rr-1.2.8/sc-2.0.4/sb-1.1.0/sp-1.3.0/sl-1.3.3/datatables.min.css"/>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="style.css" rel="stylesheet">
  <!-- <script src="element_formview.js"></script> -->

</head>

<body>
  <div class="container-fluid py-4">
    <header class="pb-3 mb-4 border-bottom">
      <a class="d-flex align-items-center text-dark text-decoration-none"></a>
        <img src = "SpaceNetLogo.jpg" height="30px">
        <span class="fs-4">SpaceNet</span>
    </header>
    <h1 class="text-dark" class="display-5">Elements</h1>

    <button type="button" class="btn btn-primary" onclick="location.href='element_formview.html'" >Add Element</button>
    <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add Element</button> -->
    <!-- <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addModal">Add New Element</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

          </div>
      </div>
        </div>
      </div>   -->


    <div>
      <table id="elements_table" class="table table-striped table-bordered" style="width: 100%">
        <thead class="thead-dark">
            <tr>
                <th> </th>
                <th>Name</th>
                <th>Type</th>
                <th>Class of Supply</th>
                <th>Environment</th>
                <th>Accomodation Mass</th>
                <th>Mass</th>
                <th>Volume</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Type</th>
            <th>Class of Supply</th>
            <th>Environment</th>
            <th>Accomodation Mass</th>
            <th>Mass</th>
            <th>Volume</th>
            <th>Description</th>
          </tr>
        </tfoot>
      </table>

    </div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.3.1/jszip-2.5.0/dt-1.10.25/af-2.3.7/b-1.7.1/b-colvis-1.7.1/b-html5-1.7.1/b-print-1.7.1/cr-1.5.4/date-1.1.0/fc-3.3.3/fh-3.1.9/kt-2.6.2/r-2.2.8/rg-1.1.3/rr-1.2.8/sc-2.0.4/sb-1.1.0/sp-1.3.0/sl-1.3.3/datatables.min.js"></script>

    <script>
        $(document).ready(function () {
          $('#elements_table tfoot th').each(function() {
            if ($(this).index() !== 0) {
              var title = $(this).text();
              $(this).html('<input type="text" placeholder="Search ' + title + '" />');
            }
          });

          $.fn.dataTable.ext.buttons.delete = {
              extend: 'selected',
              text: '<span data-customTooltip="Select row(s) to delete">Delete</span>',
              className: 'btn-style',
              action: function ( e, dt, node, config ) {
                var record = table.rows( { selected: true } ).data();
                console.log(record);
                console.log(record.length);
                for (i=0; i < record.length; i++) {
                  var element = record[i]
                  console.log(element)
                  $.ajax({
                      url: "/database/api/element/" + element.id,
                      method: "DELETE",
                      success: function(data) {
                        dt.ajax.reload();
                    }
                  });
                }
              }
          };

          // $.fn.dataTable.ext.buttons.edit = {
          //     extend: 'selectedSingle',
          //     text: '<span data-customTooltip="Select 1 row to view/edit">View/Edit</span>',
          //     className: 'btn-style',
          //     action: function ( e, dt, node, config ) {
          //       var record = table.rows( { selected: true } ).data()[0];
          //       console.log(record)
          //       $("#editModal #element option[id='" + record.type + "']").attr("selected", "true")
          //       $('#editModal #inputName').val(record.name)
          //       $('#editModal #inputAccMass').val(record.accommodation_mass)
          //       $('#editModal #inputMass').val(record.mass)
          //       $('#editModal #inputVol').val(record.volume)
          //       $("#editModal").change()
          //       $('#editModal').modal('show')
                // $.ajax({
                //   url: "/database/api/element/" + record.id,
                //   data: JSON.stringify({
                //     message: prompt("Your message:", "Hello World")
                //   }),
                //   contentType: 'application/json; charset=utf-8',
                //   dataType: "json",
                //   method: "PUT",
                //   success: function(item) {
                //     dt.ajax.reload();
                //   }
                // });     
          //     }
          // };

          // $.fn.dataTable.ext.buttons.add = {
          //     text: 'Add Element',
          //     className: 'btn-style',
          //     action: function ( e, dt, node, config ) {
          //       $.ajax({
          //         url: "/database/api/element/",
          //         data: JSON.stringify({
          //           message: prompt("Your message:", "Hello World")
          //         }),
          //         contentType: 'application/json; charset=utf-8',
          //         dataType: "json",
          //         method: "POST",
          //         success: function(item) {
          //           dt.ajax.reload();
          //         }
          //       });
          //     }
          // };

          $.fn.dataTable.ext.buttons.export = {
            extend: 'excel',
            text: 'Export',
            className: 'btn-style',
          }

          $.fn.dataTable.ext.buttons.filter = {
            extend: 'searchBuilder',
            text: 'Apply Filter',
            className: 'btn-style',
          }

          var table = $(elements_table).DataTable( {
            scrollX: true,
            ajax: {
              url: "/database/api/element/",
              dataSrc: ''
            },
            columns: [
              {data: null},
              { data: 'name' },
              { data: 'type' },
              { data: 'class_of_supply' },
              { data: 'environment' },
              { data: 'accommodation_mass' },
              { data: 'mass' },
              { data: 'volume' },
              { data: 'description' }
                ],
            buttons: [
                'export',
                'filter',
                // 'add',
                // 'edit',
                'delete',
            ],
            language: {
              searchBuilder: {
                button: {
                      0: 'Apply Filters',
                      1: 'Filters (one selected)',
                      _: 'Filters (%d)'
                  },
                add: 'Add Filter',
                title: 'Apply Custom Filters',
                data: 'Property',
              }
          },
            dom: 'BQlfrtip',
            columnDefs: [ 
            {
              targets:   0,
              searchable: false,
              orderable: false,
              defaultContent: '',
              className: 'select-checkbox',
              width: '8%',
            },
            ],
            select: {
                style:    'multi',
                selector: 'td:first-child'
            },
            order: [[ 1, 'asc' ]],
          });

          table.on( 'select deselect', function ( e, dt, type, indexes ) {
            console.log("selected something")
              var num_selected = table.rows( { selected: true } ).data().length;
              if (num_selected === 0) {
                dt.buttons([2]).text('<span data-customTooltip="Select row(s) to delete">Delete</span>')
                // dt.buttons([2]).text('<span data-customTooltip="Select 1 row to view/edit">View/Edit</span>')
              } else if (num_selected === 1) {
                dt.buttons([2]).text('Delete row')
                // dt.buttons([2]).text('View/Edit row')
              }
              else {
                dt.buttons([2]).text('Delete ' + num_selected + ' rows')
                // dt.buttons([2]).text('<span data-customTooltip="Select 1 row to view/edit">View/Edit</span>')
              }
          } );
          
          table.columns().every( function() {
            var that = this;
      
            $('input', this.footer()).on('keyup change', function() {
                if (that.search() !== this.value) {
                    that
                        .search(this.value)
                        .draw();
                }
            });
          });
          });

    </script>
      <footer class="pt-3 mt-4 text-muted border-top">
        &copy; 2021
      </footer>
    </div>
</body>


</html>